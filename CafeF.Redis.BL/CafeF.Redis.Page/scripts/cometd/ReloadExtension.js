typeof dojo!="undefined"&&dojo.provide("org.cometd.ReloadExtension");if(!org.cometd.COOKIE){org.cometd.COOKIE={};org.cometd.COOKIE.set=function(){throw"Abstract";};org.cometd.COOKIE.get=function(){throw"Abstract";}}
org.cometd.ReloadExtension=function(i){function k(){if(a&&a.handshakeResponse!==null){var b=org.cometd.JSON.toJSON(a);c("Reload extension saving cookie value",b);org.cometd.COOKIE.set("org.cometd.reload",b,{"max-age":j,path:"/",expires:new Date((new Date).getTime()+j*1E3)})}}var d,c,a=null,j=i&&i.cookieMaxAge||5,g=false;this.registered=function(b,e){d=e;d.reload=k;c=d._debug};this.unregistered=function(){delete d.reload;d=null};this.outgoing=function(b){var e=b.channel;if(e=="/meta/handshake"){a=
{};a.url=d.getURL();e=org.cometd.COOKIE.get("org.cometd.reload");c("Reload extension found cookie value",e);if(e)try{org.cometd.COOKIE.set("org.cometd.reload","",{path:"/"});var f=org.cometd.JSON.fromJSON(e);if(f&&f.handshakeResponse&&a.url==f.url){c("Reload extension restoring state",f);setTimeout(function(){c("Reload extension replaying handshake response",f.handshakeResponse);a.handshakeResponse=f.handshakeResponse;a.transportType=f.transportType;a.reloading=true;var h=d._mixin(true,{},a.handshakeResponse);
h.supportedConnectionTypes=[a.transportType];d.receive(h);c("Reload extension replayed handshake response",h)},0);if(!g){g=true;d.startBatch()}return null}else c("Reload extension could not restore state",f)}catch(l){c("Reload extension error while trying to restore cookie",l)}}else if(e=="/meta/connect")if(!a.transportType){a.transportType=b.connectionType;c("Reload extension tracked transport type",a.transportType)}return b};this.incoming=function(b){if(b.successful)switch(b.channel){case "/meta/handshake":if(!a.handshakeResponse){a.handshakeResponse=
b;c("Reload extension tracked handshake response",b)}break;case "/meta/disconnect":a=null;break;case "/meta/connect":g&&d.endBatch();g=false}return b}};
